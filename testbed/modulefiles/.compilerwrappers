
# reload compilerwrappers if loaded to ensure wrapper directory
# will always be the first directory in the path
if { [module-info mode "load"] && [is-loaded "compilerwrappers"] } {
    module unload compilerwrappers
    module load compilerwrappers
}

# update software-specific compilation-related variables if any
if [info exists ldflags] { setenv CCC_${appnameup}_LDFLAGS "$ldflags" }
if [info exists cflags] { setenv CCC_${appnameup}_CFLAGS "$cflags" }
if [info exists cxxflags] { setenv CCC_${appnameup}_CXXFLAGS "$cxxflags" }
if [info exists fflags] { setenv CCC_${appnameup}_FFLAGS "$fflags" }

# update compilerwrappers-specific variables if any
if [info exists ldflags] { append-path -delim " " CCC_LDFLAGS "$ldflags" }
if [info exists cflags] { append-path -delim " " CCC_CFLAGS "$cflags" }
if [info exists cxxflags] { append-path -delim " " CCC_CXXFLAGS "$cxxflags" }
if [info exists fflags] { append-path -delim " " CCC_FFLAGS "$fflags" }
if [info exists c] { append-path -delim " " CCC_C "$c" }
if [info exists cxx] { append-path -delim " " CCC_CXX "$cxx" }
if [info exists f77] { append-path -delim " " CCC_F77 "$f77" }
if [info exists f90] { append-path -delim " " CCC_F90 "$f90" }
if [info exists f95] { append-path -delim " " CCC_F95 "$f95" }
if [info exists f2003] { append-path -delim " " CCC_F2003 "$f2003" }
if [info exists mpic] { append-path -delim " " CCC_MPIC "$mpic" }
if [info exists mpicxx] { append-path -delim " " CCC_MPICXX "$mpicxx" }
if [info exists mpif77] { append-path -delim " " CCC_MPIF77 "$mpif77" }
if [info exists mpif90] { append-path -delim " " CCC_MPIF90 "$mpif90" }
if [info exists mpif95] { append-path -delim " " CCC_MPIF95 "$mpif95" }
if [info exists mpif2003] { append-path -delim " " CCC_MPIF2003 "$mpif2003" }

# check prace module load on one of its variable since the module itself will be
# flagged "loaded" after the full module reloading process which does not fit
# with our current autoreloading concept
if { [info exists env(PRACE_SCRATCH)] || [is-loaded prace] } {
    # add PRACE-specific application variable if any
    if [info exists exedir] { setenv PRACE_${appnameup}_EXEDIR "$exedir" }

    # as above update PRACE software-specific compilation-related variables if any
    if [info exists ldflags] { setenv PRACE_${appnameup}_LDFLAGS "$ldflags" }
    if [info exists cflags] { setenv PRACE_${appnameup}_CFLAGS "$cflags" }
    if [info exists cxxflags] { setenv PRACE_${appnameup}_CXXFLAGS "$cxxflags" }
    if [info exists fflags] { setenv PRACE_${appnameup}_FFLAGS "$fflags" }

    # as above update PRACE-specific compiler variables if any
    if [info exists ldflags] { append-path -delim " " PRACE_LDFLAGS "$ldflags" }
    if [info exists cflags] { append-path -delim " " PRACE_CFLAGS "$cflags" }
    if [info exists cxxflags] { append-path -delim " " PRACE_CXXFLAGS "$cxxflags" }
    if [info exists fflags] { append-path -delim " " PRACE_FFLAGS "$fflags" }
    if [info exists c] { append-path -delim " " PRACE_C "$c" }
    if [info exists cxx] { append-path -delim " " PRACE_CXX "$cxx" }
    if [info exists f77] { append-path -delim " " PRACE_F77 "$f77" }
    if [info exists f90] { append-path -delim " " PRACE_F90 "$f90" }
    if [info exists f95] { append-path -delim " " PRACE_F95 "$f95" }
    if [info exists f2003] { append-path -delim " " PRACE_F2003 "$f2003" }
    if [info exists mpic] { append-path -delim " " PRACE_MPIC "$mpic" }
    if [info exists mpicxx] { append-path -delim " " PRACE_MPICXX "$mpicxx" }
    if [info exists mpif77] { append-path -delim " " PRACE_MPIF77 "$mpif77" }
    if [info exists mpif90] { append-path -delim " " PRACE_MPIF90 "$mpif90" }
    if [info exists mpif95] { append-path -delim " " PRACE_MPIF95 "$mpif95" }
    if [info exists mpif2003] { append-path -delim " " PRACE_MPIF2003 "$mpif2003" }
}


